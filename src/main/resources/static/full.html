<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vet Appointment Booking</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">

<h2 class="mb-4 text-center">Book Appointment</h2>

<form id="bookingForm" class="border p-4 rounded shadow-sm">
    <!-- Pet Selection -->
    <div class="mb-3">
        <label for="petId" class="form-label">Select Pet</label>
        <select id="petId" class="form-select" required>
            <option value="">-- Select Pet --</option>
        </select>
    </div>

    <!-- Vet Selection -->
    <div class="mb-3">
        <label for="vetName" class="form-label">Select Vet</label>
        <select id="vetName" class="form-select" required>
            <option value="">-- Select Vet --</option>
        </select>
    </div>

    <!-- Date -->
    <div class="mb-3">
        <label for="date" class="form-label">Appointment Date</label>
        <input type="date" id="date" class="form-control" required>
    </div>

    <!-- Submit -->
    <button type="submit" class="btn btn-primary w-100">Book Appointment</button>
</form>

<div id="message" class="mt-3"></div>

<script>
    const PET_API = "http://localhost:8080/demo/pet/Feteching";
    const VET_API = "http://localhost:8080/demo/appointments/vets";
    const BOOKING_API = "http://localhost:8080/demo/appointments";

    // Load Pets into dropdown
    async function loadPets() {
        try {
            let res = await fetch(PET_API);
            if (!res.ok) throw new Error("Failed to fetch pets");
            let pets = await res.json();

            let petSelect = document.getElementById("petId");
            pets.forEach(pet => {
                let option = document.createElement("option");
                option.value = pet.petId;
                option.textContent = `${pet.name} (${pet.breed})`;
                petSelect.appendChild(option);
            });
        } catch (err) {
            console.error(err);
        }
    }

    // Load Vets into dropdown
    async function loadVets() {
        try {
            let res = await fetch(VET_API);
            if (!res.ok) throw new Error("Failed to fetch vets");
            let vets = await res.json();

            let vetSelect = document.getElementById("vetName");
            vets.forEach(vet => {
                let option = document.createElement("option");
                option.value = vet;
                option.textContent = vet;
                vetSelect.appendChild(option);
            });
        } catch (err) {
            console.error(err);
        }
    }

    // Handle form submission
    document.getElementById("bookingForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        let petId = document.getElementById("petId").value;
        let vetName = document.getElementById("vetName").value;
        let date = document.getElementById("date").value;

        let booking = {
            vetName: vetName,
            date: date
        };

        try {
            let res = await fetch(`${BOOKING_API}/${petId}`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(booking)
            });

            if (res.ok) {
                let data = await res.json();
                document.getElementById("message").innerHTML =
                    `<div class="alert alert-success">✅ Appointment booked successfully for ${data.pet.name} with Dr. ${data.vetName} on ${data.date}</div>`;
            } else {
                document.getElementById("message").innerHTML =
                    `<div class="alert alert-danger">❌ Failed to book appointment</div>`;
            }
        } catch (err) {
            console.error(err);
            document.getElementById("message").innerHTML =
                `<div class="alert alert-danger">⚠️ Error: ${err.message}</div>`;
        }
    });

    // Load dropdowns on page load
    document.addEventListener("DOMContentLoaded", () => {
        loadPets();
        loadVets();
    });
</script>
</body>
</html>
