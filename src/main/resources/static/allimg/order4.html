<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Page - VetPawtner</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background:#f8f8f8; }
        .container { max-width:900px; margin-top:50px; }
        h2 { color:#5a3d2b; font-weight:900; margin-bottom:1.5rem; }
        #cart-items { margin-bottom:1rem; }
        .cart-item { display:flex; justify-content:space-between; align-items:center; padding:0.6rem 0; border-bottom:1px solid #ddd; }
        .cart-item:last-child { border-bottom:none; }
        #cart-total { font-weight:700; font-size:1.2rem; margin-top:1rem; text-align:right; color:#ff6b35; }
        #btn-pay { background:linear-gradient(90deg,#ff6b35,#ff9472); color:#fff; border:none; border-radius:10px; padding:0.6rem 1.2rem; font-weight:700; }
        #btn-pay:hover { filter:brightness(1.05); }
        #popup-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center; }
        #popup { background:#fff; padding:2rem; border-radius:15px; width:90%; max-width:400px; text-align:center; position:relative; }
        #popup h3 { margin-bottom:1rem; color:#5a3d2b; }
        #popup button { margin-top:1rem; cursor:pointer; }
        #popup-cart { text-align:left; margin-bottom:0.5rem; }
        #qr-screen img { max-width:200px; margin:1rem 0; }
        #success-msg { text-align:center; margin-top:2rem; font-weight:700; color:#28a745; }
    </style>
</head>
<body>

<div class="container">
    <h2>Your Cart</h2>
    <div id="cart-items"></div>
    <div id="cart-total"></div>
    <div class="text-end mt-3">
        <button id="btn-pay">Continue to Payment</button>
    </div>
    <div id="success-msg"></div>
</div>

<!-- Popup overlay -->
<div id="popup-overlay" class="d-flex">
    <div id="popup">
        <!-- Confirm Payment -->
        <div id="popup-content">
            <h3>Confirm Payment</h3>
            <div id="popup-cart"></div>
            <div id="popup-total"></div>
            <button id="btn-confirm">Pay Now</button>
            <button id="btn-cancel" class="btn btn-secondary mt-2">Cancel</button>
        </div>

        <!-- QR Code screen -->
        <div id="qr-screen" style="display:none;">
            <h3>Scan QR to Pay</h3>
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=VetPawtnerPayment" alt="QR Code">
            <div>
                <button id="btn-qr-done" style="background:linear-gradient(90deg,#ff6b35,#ff9472); color:#fff; border:none; border-radius:10px; padding:0.5rem 1.2rem; font-weight:700; margin-top:10px;">Payment Done</button>
            </div>
        </div>
    </div>
</div>

<script>
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    function renderCart() {
        const cartContainer = document.getElementById('cart-items');
        cartContainer.innerHTML = '';
        let total = 0;
        cart.forEach(item => {
            const div = document.createElement('div');
            div.className = 'cart-item';
            div.innerHTML = `<span>${item.product_name} x ${item.qty}</span><span>₹${(item.price*item.qty).toFixed(2)}</span>`;
            cartContainer.appendChild(div);
            total += item.price*item.qty;
        });
        document.getElementById('cart-total').textContent = `Total: ₹${total.toFixed(2)}`;
    }

    renderCart();

    // Popup logic
    const popupOverlay = document.getElementById('popup-overlay');
    const popup = document.getElementById('popup');
    const btnPay = document.getElementById('btn-pay');
    const btnConfirm = document.getElementById('btn-confirm');
    const btnCancel = document.getElementById('btn-cancel');
    const successMsg = document.getElementById('success-msg');

    btnPay.addEventListener('click', ()=>{
        if(cart.length===0){
            alert('Your cart is empty!');
            return;
        }
        // populate popup cart
        const popupCart = document.getElementById('popup-cart');
        const popupTotal = document.getElementById('popup-total');
        popupCart.innerHTML='';
        let total=0;
        cart.forEach(item=>{
            const div = document.createElement('div');
            div.textContent = `${item.product_name} x ${item.qty} - ₹${(item.price*item.qty).toFixed(2)}`;
            popupCart.appendChild(div);
            total+=item.price*item.qty;
        });
        popupTotal.textContent = `Total: ₹${total.toFixed(2)}`;
        popupOverlay.style.display='flex';
    });

    // Cancel button
    btnCancel.addEventListener('click', ()=>{
        popupOverlay.style.display='none';
    });

    // Confirm Pay -> Show QR
    btnConfirm.addEventListener('click', ()=>{
        document.getElementById('popup-content').style.display='none';
        document.getElementById('qr-screen').style.display='block';
    });

    // QR Done -> Success
    document.getElementById('btn-qr-done').addEventListener('click', ()=>{
        popupOverlay.style.display='none';
        successMsg.textContent = '✅ Payment Successful! Thank you for your order.';
        localStorage.removeItem('cart');
        cart=[];
        renderCart();

        // Reset popup for next use
        document.getElementById('popup-content').style.display='block';
        document.getElementById('qr-screen').style.display='none';
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
